# ===============================================
# HAILO AI VIDEO STREAMING SERVER CONFIGURATION
# ===============================================

# Redis Configuration
REDIS_HOST=localhost
REDIS_PORT=6379
RAW_FRAME_INPUT_CHANNEL=camera:frames:rpi
ANNOTATED_FRAME_OUTPUT_CHANNEL=ai_stream:frames:rpi

# Redis Connection Optimization (Enhanced for Stability)
REDIS_CONNECTION_POOL_SIZE=20
REDIS_SOCKET_TIMEOUT=10
REDIS_SOCKET_CONNECT_TIMEOUT=10
REDIS_HEALTH_CHECK_INTERVAL=15
REDIS_RETRY_ON_TIMEOUT=true
REDIS_MAX_RECONNECT_ATTEMPTS=5

# Server Configuration
SERVER_HOST=0.0.0.0
SERVER_PORT=8001

# AI Model Configuration
AI_MODEL_PATH=yolov8n.hef
CONFIDENCE_THRESHOLD=0.25
JPEG_QUALITY=60

# Model Input Size Configuration (Auto-detected from HEF)
MODEL_INPUT_WIDTH=640
MODEL_INPUT_HEIGHT=640
MAINTAIN_ASPECT_RATIO=true

# Frame Processing Optimization (CPU Load Reduction)
ENABLE_FRAME_SKIPPING=true
PROCESS_EVERY_N_FRAMES=4
MAX_PROCESSING_FPS=20.0
SKIP_FRAMES_ON_HIGH_CPU=true
CPU_THRESHOLD_FOR_SKIPPING=65.0
MEMORY_THRESHOLD_FOR_SKIPPING=75.0
ADAPTIVE_FRAME_SKIPPING=true

# Performance Optimization (Balanced Settings)
ENABLE_PERFORMANCE_MODE=true
LOW_LATENCY_MODE=false
BATCH_PROCESSING=false
OPTIMIZE_FOR_POWER_SAVING=true
REDUCE_OVERLAY_FREQUENCY=true
OVERLAY_UPDATE_EVERY_N_FRAMES=5

# Stream Configuration
STREAM_TIMEOUT=5.0
RECONNECT_DELAY=1.0
MAX_RECONNECT_ATTEMPTS=10

# Verbose Overlay Settings (Optimized for Performance)
ENABLE_VERBOSE_OVERLAY=true
OVERLAY_POSITION=TOP_LEFT
OVERLAY_FONT_SIZE=0.4
OVERLAY_BACKGROUND=true
SHOW_FRAME_DETAILS=true
SHOW_MODEL_DETAILS=true
SHOW_PROCESSING_METRICS=true
SHOW_DETECTION_DETAILS=true
SHOW_SYSTEM_METRICS=true
SHOW_FRAME_SKIP_STATS=true
MAX_DETECTION_LINES=6
OVERLAY_UPDATE_INTERVAL=1

# Camera Raspberry Pi Settings (Optimized for Performance)
CAMERA_RPI_RESOLUTION_WIDTH=960
CAMERA_RPI_RESOLUTION_HEIGHT=540
CAMERA_RPI_FPS=30
CAMERA_RPI_JPEG_QUALITY=85
CAMERA_RPI_SHUTTER_SPEED=0
CAMERA_RPI_ISO=0
CAMERA_RPI_MANUAL_FOCUS=0.0

# Advanced Performance Tuning
OPENCV_NUM_THREADS=2
NUMEXPR_NUM_THREADS=2
ENABLE_CPU_GOVERNOR_CONTROL=true
PREFERRED_CPU_GOVERNOR=performance

# System Resource Monitoring
ENABLE_SYSTEM_MONITORING=true
MONITOR_UPDATE_INTERVAL=1.0
TEMPERATURE_WARNING_THRESHOLD=70.0
TEMPERATURE_CRITICAL_THRESHOLD=80.0

# Logging and Debugging
ENABLE_DEBUG_LOGGING=false
LOG_LEVEL=INFO
ENABLE_FRAME_TIMING=true
ENABLE_PERFORMANCE_LOGGING=true
LOG_SKIP_STATISTICS=true

# Network and Connectivity
NETWORK_TIMEOUT=10
CONNECTION_RETRY_ATTEMPTS=3
KEEPALIVE_INTERVAL=30

# Memory Management
ENABLE_MEMORY_OPTIMIZATION=true
GARBAGE_COLLECTION_INTERVAL=60
MAX_MEMORY_USAGE_PERCENT=80.0

# Emergency CPU Relief Settings
EMERGENCY_CPU_THRESHOLD=85.0
EMERGENCY_SKIP_FACTOR=8
ENABLE_EMERGENCY_MODE=true

# ===============================================
# CONFIGURATION PROFILES
# ===============================================

# Uncomment one of these profiles for quick setup:

# HIGH PERFORMANCE (More CPU usage, better quality)
# PROCESS_EVERY_N_FRAMES=2
# MAX_PROCESSING_FPS=25.0
# CAMERA_RPI_RESOLUTION_WIDTH=1280
# CAMERA_RPI_RESOLUTION_HEIGHT=720
# CAMERA_RPI_FPS=60

# BALANCED (Recommended for most use cases)
# PROCESS_EVERY_N_FRAMES=4
# MAX_PROCESSING_FPS=20.0
# CAMERA_RPI_RESOLUTION_WIDTH=960
# CAMERA_RPI_RESOLUTION_HEIGHT=540
# CAMERA_RPI_FPS=30

# POWER SAVING (Lower CPU usage, reduced quality)
# PROCESS_EVERY_N_FRAMES=6
# MAX_PROCESSING_FPS=15.0
# CAMERA_RPI_RESOLUTION_WIDTH=640
# CAMERA_RPI_RESOLUTION_HEIGHT=480
# CAMERA_RPI_FPS=20
# ENABLE_VERBOSE_OVERLAY=false

# ===============================================
# TROUBLESHOOTING SETTINGS
# ===============================================

# If experiencing high CPU usage, try:
# PROCESS_EVERY_N_FRAMES=8
# MAX_PROCESSING_FPS=10.0
# CPU_THRESHOLD_FOR_SKIPPING=60.0
# ENABLE_VERBOSE_OVERLAY=false

# If experiencing Redis connection issues, try:
# REDIS_SOCKET_TIMEOUT=15
# REDIS_HEALTH_CHECK_INTERVAL=10
# MAX_RECONNECT_ATTEMPTS=10

# If experiencing memory issues, try:
# MEMORY_THRESHOLD_FOR_SKIPPING=70.0
# GARBAGE_COLLECTION_INTERVAL=30
# REDUCE_OVERLAY_FREQUENCY=true

# ===============================================
# MODEL-SPECIFIC SETTINGS
# ===============================================

# For YOLOv8n (Default - Fastest)
# AI_MODEL_PATH=yolov8n.hef
# CONFIDENCE_THRESHOLD=0.25

# For YOLOv8s (Better accuracy, higher CPU)
# AI_MODEL_PATH=yolov8s.hef
# CONFIDENCE_THRESHOLD=0.3
# PROCESS_EVERY_N_FRAMES=6

# For YOLOv8m (Best accuracy, highest CPU)
# AI_MODEL_PATH=yolov8m.hef
# CONFIDENCE_THRESHOLD=0.35
# PROCESS_EVERY_N_FRAMES=8
# MAX_PROCESSING_FPS=10.0

# ===============================================
# DEVELOPMENT AND TESTING
# ===============================================

# Development Mode (More verbose logging)
# ENABLE_DEBUG_LOGGING=true
# LOG_LEVEL=DEBUG
# SHOW_FRAME_DETAILS=true
# ENABLE_FRAME_TIMING=true

# Production Mode (Optimized performance)
# ENABLE_DEBUG_LOGGING=false
# LOG_LEVEL=INFO
# REDUCE_OVERLAY_FREQUENCY=true
# OPTIMIZE_FOR_POWER_SAVING=true
